---
title: ""
author: ""
date: ""
output: html_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
library(dplyr)
library(DT)
library(rmarkdown)

stock_list_raw <- jsonlite::fromJSON("http://internalservices.ices.local:60/api/SDInternalDWs",
                                     simplifyDataFrame = TRUE)

benchmark_list <- function(type,
                           year,
                           active_year = NULL) {

  type <- rlang::enquo(type)
  year <- rlang::enquo(year)
  
  if(is.null(active_year)){
  active_year <- as.numeric(format(Sys.Date(), format = "%Y"))
  active_year <-  rlang::enquo(active_year)
  } 
  
  stock_list_raw %>% 
    filter(rlang::UQ(type) %in% rlang::UQ(year) & 
             ActiveYear == rlang::UQ(active_year)) %>% 
    arrange(ExpertGroup) %>% 
    mutate(StockKeyLabel = as.factor(StockKeyLabel),
           StockKeyDescription = as.factor(StockKeyDescription),
           ExpertGroup = as.factor(ExpertGroup),
           DataCategory = as.factor(floor(as.numeric(DataCategory))),
           WKname = as.factor(NA),
           WKdate = as.factor(NA),
           WKchair = as.factor(NA)) %>% 
    select(`Stock code` = StockKeyLabel,
           `Stock name` = StockKeyDescription,
           `Data category` = DataCategory,
           `Expert group` = ExpertGroup,
           `Benchmark process` = WKname,
           `Benchmark date` = WKdate,
           `Benchmark chair` = WKchair) %>% 
    distinct(.keep_all = TRUE) %>% 
    DT::datatable(.,
                  rownames = FALSE,
                  filter = "top",
                  options = list(pageLength = 20,
                                 dom = "tip")
    )
}

this_year <- as.numeric(format(Sys.Date(), format = "%Y"))
next_year <- this_year + 1
later_years <- c(next_year, next_year + 1)

```

[<img align="right" alt="ICES Logo" width="17%" height="17%" src="http://ices.dk/_layouts/15/1033/images/icesimg/iceslogo.png">](http://ices.dk)

## Benchmark Overview {.tabset .tabset-fade}

### `r this_year` Benchmarks
```{r this_year_benchmark, echo = FALSE}

benchmark_list(type = PlannedBenchmark,
               year = this_year)
```

### `r next_year` Benchmarks
```{r next_year_benchmark, echo = FALSE}

benchmark_list(type = PlannedBenchmark,
               year = next_year,
               active_year = 2017)

```

### Proposed Benchmarks
```{r benchmarks_proposed, echo = FALSE}

benchmark_list(type = ProposedBenchmark,
               year = later_years)

```

#
Proposed benchmarks have been requested by an Assessment Working Group but have not yet been agreed upon by ACOM.

_Last updated on `r format(Sys.Date(), format = "%e %B %Y")`._
